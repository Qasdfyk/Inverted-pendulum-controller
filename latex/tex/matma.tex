\section{Model matematyczny układu}

Celem niniejszego rozdziału jest szczegółowe wyprowadzenie modelu 
matematycznego obiektu sterowania, którym jest odwrócone wahadło na~wózku. 
Precyzyjne odwzorowanie dynamiki procesu jest fundamentalnym etapem 
projektowania układu sterowania, gdyż jakość modelu bezpośrednio wpływa 
na~skuteczność algorytmów predykcyjnych (MPC) oraz optymalnych (LQR). 
Wyprowadzenie oparto na~prawach mechaniki klasycznej oraz analizie sił 
i~momentów przedstawionej w~literaturze przedmiotu~\cite{Prasad2014}.

\subsection{Opis fizyczny i~założenia upraszczające}

Rozważany obiekt sterowania należy do~klasy mechanicznych układów 
podwzbudnych (ang. \textit{underactuated systems}), co oznacza, że liczba 
wejść sterujących jest mniejsza od~liczby stopni swobody. Układ składa się 
z~wózka poruszającego się wzdłuż poziomej osi oraz pręta z~masą skupioną, 
zamocowanego przegubowo do~wózka.

Przyjęto następujące parametry fizyczne modelu, zgodne z~oznaczeniami 
stosowanymi w~pracach badawczych~\cite{Prasad2014}:
\begin{itemize}
    \item \(M\) --- masa wózka [kg],
    \item \(m\) --- masa wahadła (traktowana jako masa punktowa na~końcu pręta) [kg],
    \item \(l\) --- długość wahadła (odległość od~osi obrotu do~środka ciężkości) [m],
    \item \(g\) --- przyspieszenie ziemskie [m/s\textsuperscript{2}],
    \item \(F(t)\) --- siła sterująca przyłożona do~wózka [N],
    \item \(F_{\mathrm{w}}(t)\) --- siła zakłócająca (wiatr) działająca poziomo na~masę wahadła [N].
\end{itemize}

W~celu sformułowania modelu analitycznego przyjęto następujące założenia 
upraszczające~\cite{Prasad2014}:
\begin{enumerate}
    \item Pręt wahadła jest nieważki i~sztywny.
    \item Tarcie w~łożyskach kół wózka oraz w~przegubie wahadła jest pomijalnie małe.
    \item Ruch odbywa się w~płaszczyźnie pionowej \(x-y\).
\end{enumerate}

TODO - zdjecie jakies


Układ odniesienia zdefiniowano w~taki sposób, że współrzędna \(x(t)\) 
opisuje poziome przesunięcie wózka, natomiast kąt \(\theta(t)\) określa 
wychylenie wahadła od~pionu w~kierunku zgodnym z~ruchem wskazówek zegara. 
Pozycja \(\theta = 0\) odpowiada niestabilnemu punktowi równowagi 
(wahadło w~górze).

\subsection{Analiza kinematyczna}

W~pierwszej kolejności zdefiniowano położenie środka ciężkości (COG) 
masy wahadła \(m\) w~nieruchomym układzie odniesienia. Oznaczając 
współrzędne środka masy jako \((x_{\mathrm{G}}, y_{\mathrm{G}})\), można je wyrazić jako sumę 
przemieszczenia wózka oraz rzutu geometrycznego ramienia wahadła~\cite{Prasad2014}:

\begin{equation}
    x_{\mathrm{G}}(t) = x(t) + l \sin\theta(t),
    \label{eq:pos_x}
\end{equation}
\begin{equation}
    y_{\mathrm{G}}(t) = l \cos\theta(t).
    \label{eq:pos_y}
\end{equation}

Gdzie \(x_{\mathrm{G}}\) to pozioma współrzędna masy wahadła, a~\(y_{\mathrm{G}}\) to jej 
współrzędna pionowa (odległość od~osi wózka).

Aby zastosować drugą zasadę dynamiki Newtona dla masy \(m\), konieczne jest 
wyznaczenie jej prędkości oraz przyspieszeń całkowitych (bezwzględnych). 
Różniczkując równania (\ref{eq:pos_x}) i~(\ref{eq:pos_y}) względem czasu, 
otrzymuje się składowe prędkości:
\begin{equation}
    \dot{x}_G(t) = \dot{x}(t) + l \cos\theta(t) \cdot \dot{\theta}(t),
\end{equation}
\begin{equation}
    \dot{y}_G(t) = -l \sin\theta(t) \cdot \dot{\theta}(t).
\end{equation}

Ponowne różniczkowanie pozwala wyznaczyć składowe przyspieszenia środka 
masy wahadła \(\ddot{x}_G\) oraz \(\ddot{y}_G\). Uwzględniają one zarówno 
przyspieszenie liniowe wózka, jak i~składowe ruchu obrotowego 
(przyspieszenie styczne i~dośrodkowe):
\begin{equation}
    \ddot{x}_G(t) = \ddot{x}(t) + l \cos\theta(t) \cdot \ddot{\theta}(t) - l \sin\theta(t) \cdot \dot{\theta}^2(t),
    \label{eq:acc_x}
\end{equation}
\begin{equation}
    \ddot{y}_G(t) = -l \sin\theta(t) \cdot \ddot{\theta}(t) - l \cos\theta(t) \cdot \dot{\theta}^2(t).
    \label{eq:acc_y}
\end{equation}

Powyższe zależności (\ref{eq:acc_x}) i~(\ref{eq:acc_y}) są kluczowe, 
ponieważ siły bezwładności działające na~masę wahadła zależą od~jej 
całkowitego przyspieszenia w~przestrzeni, a~nie tylko od~kąta wychylenia.

\subsection{Równania dynamiki układu}

Model dynamiczny wyprowadzono, rozpatrując siły działające na~wózek oraz 
na~wahadło osobno, a~następnie składając je w~układ równań sprzężonych.

\subsubsection{Bilans sił w~kierunku poziomym}
Zgodnie z~drugą zasadą dynamiki Newtona, suma sił zewnętrznych działających 
na~cały układ w~kierunku osi \(x\) musi równać się zmianie pędu układu. 
Siłami zewnętrznymi są: siła sterująca \(u(t)\) przyłożona do~wózka oraz 
siła zakłócająca \(F_{\mathrm{w}}(t)\) przyłożona do~masy wahadła~\cite{Prasad2014}.

Równanie równowagi sił dla całego układu (masy \(M\) i~\(m\)) 
przyjmuje postać:
\begin{equation}
    M \ddot{x}(t) + m \ddot{x}_G(t) = u(t) + F_{\mathrm{w}}(t).
    \label{eq:force_balance_raw}
\end{equation}

Podstawiając wyznaczone wcześniej przyspieszenie poziome środka masy 
wahadła (\ref{eq:acc_x}) do~równania (\ref{eq:force_balance_raw}), 
otrzymujemy:
\begin{equation}
    M \ddot{x}(t) + m \left( \ddot{x}(t) + l \cos\theta(t) \cdot \ddot{\theta}(t) - l \sin\theta(t) \cdot \dot{\theta}^2(t) \right) = u(t) + F_{\mathrm{w}}(t).
\end{equation}

Po~uporządkowaniu wyrazów i~wyciągnięciu \(\ddot{x}\) przed nawias, 
otrzymujemy pierwsze równanie różniczkowe opisujące ruch postępowy układu:
\begin{equation}
    (M + m)\ddot{x}(t) + m l \cos\theta(t) \cdot \ddot{\theta}(t) - m l \sin\theta(t) \cdot \dot{\theta}^2(t) = u(t) + F_{\mathrm{w}}(t).
    \label{eq:dynamic_translation}
\end{equation}

\subsubsection{Bilans momentów sił}
Ruch obrotowy wahadła opisano poprzez sumę momentów sił względem punktu 
zawieszenia (przegubu na~wózku). Siłami generującymi moment obrotowy są 
siły bezwładności masy wahadła, siła ciężkości oraz siła zakłócająca.

Zgodnie z~analizą przedstawioną w~pracy~\cite{Prasad2014}, równanie momentów 
przyjmuje postać:
\begin{equation}
    m \ddot{x}_G(t) l \cos\theta(t) - m \ddot{y}_G(t) l \sin\theta(t) = m g l \sin\theta(t) + F_{\mathrm{w}}(t) l \cos\theta(t).
    \label{eq:torque_balance_raw}
\end{equation}

W~równaniu tym lewa strona reprezentuje moment wynikający z~sił 
bezwładności, natomiast prawa strona uwzględnia momenty od~sił 
zewnętrznych (grawitacji i~wiatru). Należy zauważyć, że siła wiatru \(F_{\mathrm{w}}(t)\) 
działa poziomo, stąd jej ramię siły względem punktu obrotu wynosi 
\(l \cos\theta(t)\).

Podstawiając wyrażenia na~przyspieszenia \(\ddot{x}_G\) (\ref{eq:acc_x}) 
oraz \(\ddot{y}_G\) (\ref{eq:acc_y}) do~równania momentów 
(\ref{eq:torque_balance_raw}), otrzymujemy rozbudowaną postać równania:
\begin{equation}
\begin{split}
    m l \cos\theta(t) \left( \ddot{x}(t) + l \cos\theta(t) \ddot{\theta}(t) - l \sin\theta(t) \dot{\theta}^2(t) \right) \\
    - m l \sin\theta(t) \left( -l \sin\theta(t) \ddot{\theta}(t) - l \cos\theta(t) \dot{\theta}^2(t) \right) = m g l \sin\theta(t) + F_{\mathrm{w}}(t) l \cos\theta(t).
\end{split}
\end{equation}

Po~wymnożeniu nawiasów składniki zawierające \(\dot{\theta}^2\) 
wzajemnie się redukują. Wykorzystując jedynkę trygonometryczną 
\(\cos^2\theta + \sin^2\theta = 1\) oraz dzieląc całe równanie przez \(l\), 
otrzymujemy ostateczne drugie równanie dynamiki~\cite{Prasad2014}:
\begin{equation}
    m \cos\theta(t) \cdot \ddot{x}(t) + m l \cdot \ddot{\theta}(t) = m g \sin\theta(t) + F_{\mathrm{w}}(t) \cos\theta(t).
    \label{eq:dynamic_rotation}
\end{equation}

\subsection{Nieliniowy model w~przestrzeni stanów}

Układ równań (\ref{eq:dynamic_translation}) i~(\ref{eq:dynamic_rotation}) 
stanowi kompletny, sprzężony opis dynamiki. W~celu przeprowadzenia 
symulacji numerycznej, konieczne jest rozprzężenie układu i~wyznaczenie 
jawnych postaci przyspieszeń \(\ddot{x}\) i~\(\ddot{\theta}\).

Wyznaczając \(\ddot{x}\) z~równania (\ref{eq:dynamic_rotation}):
\begin{equation}
    \ddot{x}(t) = \frac{1}{m \cos\theta(t)} \left( m g \sin\theta(t) + F_{\mathrm{w}}(t) \cos\theta(t) - m l \ddot{\theta}(t) \right),
\end{equation}
i~podstawiając do~równania (\ref{eq:dynamic_translation}), a~następnie 
wykonując przekształcenia algebraiczne, otrzymujemy jawne wzory 
na~przyspieszenia.

Ostateczne równania ruchu, uwzględniające wpływ siły sterującej \(u\) 
oraz zakłócenia \(F_{\mathrm{w}}\), przyjmują postać~\cite{Prasad2014}:

\begin{equation}
    \ddot{x}(t) = \frac{u(t) + m l \sin\theta(t) \cdot \dot{\theta}^2(t) - m g \sin\theta(t) \cos\theta(t) + F_{\mathrm{w}}(t) \sin^2\theta(t)}{M + m - m \cos^2\theta(t)},
    \label{eq:x_dd_final}
\end{equation}

\begin{equation}
    \ddot{\theta}(t) = \frac{(M + m) g \sin\theta(t) - u(t) \cos\theta(t) - m l \sin\theta(t) \cos\theta(t) \cdot \dot{\theta}^2(t) - \frac{M}{m} F_{\mathrm{w}}(t) \cos\theta(t) + F_{\mathrm{w}}(t) \cos\theta(t)}{l (M + m - m \cos^2\theta(t))}.
    \label{eq:theta_dd_final}
\end{equation}

Definiując wektor stanu \(\mathbf{x} = [\theta, \dot{\theta}, x, \dot{x}]^T\), 
model w~przestrzeni stanów zapisujemy jako układ czterech równań 
różniczkowych pierwszego rzędu:

\begin{equation}
    \begin{bmatrix}
    \dot{x}_1 \\ \dot{x}_2 \\ \dot{x}_3 \\ \dot{x}_4
    \end{bmatrix}
    =
    \begin{bmatrix}
    x_2 \\
    \frac{(M + m) g \sin x_1 - u \cos x_1 - m l (\sin x_1 \cos x_1) x_2^2 - F_{\mathrm{w}} \left(\frac{M}{m} \cos x_1 - \cos x_1\right)}{l ( M + m - m \cos^2 x_1 )} \\
    x_4 \\
    \frac{u + m l (\sin x_1) x_2^2 - m g \sin x_1 \cos x_1 + F_{\mathrm{w}} \sin^2 x_1}{M + m - m \cos^2 x_1}
    \end{bmatrix}.
\end{equation}

\subsection{Linearyzacja modelu w~punkcie pracy}

W~celu zastosowania algorytmów sterowania liniowego (PID, LQR), 
przeprowadzono linearyzację modelu nieliniowego wokół punktu równowagi 
chwiejnej (\(\theta=0\)). Dla małych wychyleń zastosowano przybliżenia 
\(\sin\theta \approx \theta\), \(\cos\theta \approx 1\), a~wyrazy wyższego 
rzędu (\(\dot{\theta}^2\), \(\sin^2\theta\)) pominięto.

Liniowy model układu w~postaci \(\dot{\mathbf{x}} = A \mathbf{x} + B u + B_{\mathrm{dist}} F_{\mathrm{w}}\) 
opisują macierze wyznaczone zgodnie z~literaturą~\cite{Prasad2014}:

\begin{equation}
    A =
    \begin{bmatrix}
    0 & 1 & 0 & 0 \\
    \frac{(M + m) g}{M l} & 0 & 0 & 0 \\
    0 & 0 & 0 & 1 \\
    -\frac{m g}{M} & 0 & 0 & 0
    \end{bmatrix}.
\end{equation}

Macierz sterowania \(B\) oraz macierz zakłóceń \(B_{\mathrm{dist}}\) przyjmują postać:
\begin{equation}
    B =
    \begin{bmatrix}
    0 \\[4pt]
    -\frac{1}{M l} \\[4pt]
    0 \\[4pt]
    \frac{1}{M}
    \end{bmatrix},
    \quad
    B_{\mathrm{dist}} =
    \begin{bmatrix}
    0 \\[4pt]
    -\frac{1}{m l} \\[4pt]
    0 \\[4pt]
    0
    \end{bmatrix}.
\end{equation}

Warto zauważyć, że w~modelu zlinearyzowanym wpływ wiatru na~przyspieszenie 
    kątowe wahadła jest odwrotnie proporcjonalny do~masy \(m\) (element \(-\frac{1}{ml}\) 
    w~macierzy \(B_{\mathrm{dist}}\)), podczas gdy w~równaniu przyspieszenia wózka 
    efekt ten zanika dla małych kątów (element zerowy). Jest to zgodne 
    z~wynikami prezentowanymi w~pracy źródłowej~\cite{Prasad2014}.

\subsection{Analiza zachowania układu w pętli otwartej}

Odwrócone wahadło jest z natury układem niestabilnym w górnym punkcie równowagi ($\theta = 0$). Aby zobrazować tę właściwość, przeprowadzono symulację zachowania obiektu bez działania układu sterowania ($u(t) = 0$), przy niewielkim wychyleniu początkowym $\theta_0 = 0{,}1$ rad (ok. $5{,}7^\circ$).

Jak pokazano na Rys. \ref{fig:open_loop}, nawet niewielkie odchylenie od pionu powoduje, że pod wpływem siły grawitacji wahadło gwałtownie traci równowagę i opada. W rzeczywistym układzie fizycznym, obecność tarcia w przegubie oraz oporu powietrza sprawia, że energia mechaniczna jest rozpraszana. W rezultacie, kąt wychylenia \(\theta(t)\) dąży do stabilnego punktu równowagi dolnej, tj. \(\theta = \pi\) rad.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/open_loop.png}
    \caption{Symulacja odpowiedzi swobodnej układu (z uwzględnionym tłumieniem) na małe wychylenie początkowe. Układ opuszcza niestabilny punkt równowagi ($\theta \approx 0$) i stabilizuje się w pozycji wiszącej ($\theta = \pi$).}
    \label{fig:open_loop}
\end{figure}